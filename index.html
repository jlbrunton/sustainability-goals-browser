<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK&I Structural Sustainability Goals Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: white;
            min-height: 100vh;
            color: #000000;
            line-height: 1.6;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            border-radius: 0;
            padding: 36pt;
            max-width: 500px;
            width: 90%;
            border-top: 4pt solid #008768;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .modal h2 {
            font-size: 21pt;
            line-height: 24pt;
            font-weight: bold;
            color: #000000;
            margin-bottom: 18pt;
            text-align: center;
        }

        .modal p {
            font-size: 9pt;
            line-height: 12pt;
            color: #000000;
            margin-bottom: 24pt;
            text-align: center;
        }

        .modal-dropdown {
            width: 100%;
            padding: 12pt;
            border: 2pt solid #008768;
            background: white;
            color: #000000;
            font-size: 12pt;
            line-height: 15pt;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 24pt;
        }

        .modal-dropdown:focus {
            outline: 2pt solid #008768;
            outline-offset: 2pt;
        }

        .modal-btn {
            width: 100%;
            padding: 12pt 24pt;
            background: #008768;
            color: white;
            border: none;
            font-size: 12pt;
            line-height: 15pt;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn:hover {
            background: #00353e;
        }

        .modal-btn:disabled {
            background: #d0d0d0;
            cursor: not-allowed;
        }

        /* Grid System */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 24pt;
        }

        /* Typography */
        .heading-05 {
            font-size: 21pt;
            line-height: 24pt;
            font-weight: bold;
            color: #000000;
            margin-bottom: 15pt;
        }

        .hidden {
            display: none;
        }

        /* Filter section */
        .filters {
            background: #f6f6f6;
            padding: 24pt;
            margin-bottom: 24pt;
        }

        .filters-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24pt;
            align-items: start;
        }

        .filter-group {
            margin-bottom: 0;
        }

        .filter-label {
            font-size: 12pt;
            line-height: 15pt;
            font-weight: bold;
            color: #000000;
            margin-bottom: 9pt;
            display: block;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6pt;
        }

        .filter-btn {
            padding: 6pt 12pt;
            border: 1pt solid #008768;
            background: white;
            color: #008768;
            font-size: 9pt;
            line-height: 12pt;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: none;
        }

        .filter-btn:hover {
            background: rgba(0, 135, 104, 0.1);
        }

        .filter-btn.active {
            background: #008768;
            color: white;
        }

        .role-dropdown {
            width: 100%;
            padding: 9pt 12pt;
            border: 1pt solid #008768;
            background: white;
            color: #000000;
            font-size: 9pt;
            line-height: 12pt;
            font-weight: normal;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        /* Style for disabled dropdown */
        .role-dropdown:disabled {
            background: #f0f0f0;
            cursor: not-allowed;
        }

        .role-dropdown:hover {
            background: rgba(0, 135, 104, 0.05);
        }

        .role-dropdown:focus {
            outline: 2pt solid #008768;
            outline-offset: 1pt;
        }

        /* Goal viewer */
        .goal-viewer {
            background: white;
            border: 1pt solid #d0d0d0;
            position: relative;
            min-height: 400px;
        }

        .goal-viewer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3pt;
            background: #008768;
        }

        .goal-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18pt 24pt;
            background: #f6f6f6;
            border-bottom: 1pt solid #d0d0d0;
        }

        .nav-btn {
            padding: 9pt 15pt;
            background: #008768;
            color: white;
            border: none;
            font-size: 12pt;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6pt;
        }

        .nav-btn:hover {
            background: #00353e;
        }

        .nav-btn:disabled {
            background: #d0d0d0;
            color: #646363;
            cursor: not-allowed;
        }

        .goal-counter {
            font-size: 12pt;
            line-height: 15pt;
            font-weight: bold;
            color: #00353e;
        }

        .goal-content {
            padding: 24pt;
        }

        .goal-title {
            font-size: 18pt;
            line-height: 21pt;
            font-weight: bold;
            color: #000000;
            margin-bottom: 12pt;
        }

        .goal-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6pt;
            margin-bottom: 18pt;
        }

        .meta-tag {
            padding: 3pt 9pt;
            font-size: 7pt;
            line-height: 9pt;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5pt;
        }

        .meta-tag.job-level {
            background: rgba(0, 135, 104, 0.1);
            color: #008768;
            border: 1pt solid #008768;
        }

        .meta-tag.category {
            background: rgba(174, 204, 83, 0.1);
            color: #5a7a1a;
            border: 1pt solid #aecc53;
        }

        .meta-tag.type {
            background: rgba(0, 53, 62, 0.1);
            color: #00353e;
            border: 1pt solid #00353e;
        }

        .goal-description {
            font-size: 10pt;
            line-height: 15pt;
            color: #000000;
            margin-bottom: 18pt;
        }

        .goal-bullets {
            list-style: none;
            padding: 0;
            margin: 0 0 24pt 0;
        }

        .goal-bullets li {
            font-size: 9pt;
            line-height: 12pt;
            color: #000000;
            margin-bottom: 9pt;
            padding-left: 15pt;
            position: relative;
        }

        .goal-bullets li::before {
            content: '–';
            position: absolute;
            left: 0;
            color: #008768;
            font-weight: bold;
        }

        .copy-btn {
            padding: 9pt 18pt;
            background: #e52713;
            color: white;
            border: none;
            font-size: 9pt;
            line-height: 12pt;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: none;
            letter-spacing: normal;
            float: right;
        }

        .copy-btn:hover {
            background: #00353e;
        }

        .copy-btn:active {
            background: #aecc53;
            color: #000000;
        }

        .no-goals {
            text-align: center;
            padding: 72pt;
            color: #646363;
        }

        .no-goals h3 {
            font-size: 18pt;
            line-height: 21pt;
            font-weight: bold;
            margin-bottom: 12pt;
            color: #000000;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 12pt;
            }
            
            .modal {
                padding: 24pt;
                margin: 12pt;
            }
            
            .filters-row {
                grid-template-columns: 1fr;
                gap: 18pt;
            }
            
            .filter-group {
                margin-bottom: 18pt;
            }
            
            .filters {
                padding: 18pt;
            }
            
            .goal-content {
                padding: 18pt;
            }
            
            .goal-navigation {
                padding: 12pt 18pt;
            }
            
            .nav-btn {
                padding: 6pt 12pt;
                font-size: 10pt;
            }
        }
    </style>
</head>
<body>
    <div id="welcomeModal" class="modal-overlay">
        <div class="modal">
            <h2>UK&I Structural Sustainability Goals</h2>
            <p>Welcome! This tool helps you explore sustainability goals aligned with UK Structural Engineers Declare commitments. To get started, please select your current job role to see the most relevant goals for your level.</p>
            
            <label for="modalRoleSelect" class="filter-label">What is your job role?</label>
            <select id="modalRoleSelect" class="modal-dropdown">
                <option value="">Please select your role...</option>
                <option value="graduate_engineer">Graduate Engineer</option>
                <option value="engineer">Engineer</option>
                <option value="senior_engineer">Senior Engineer</option>
                <option value="principal_engineer">Principal Engineer</option>
                <option value="associate_director">Associate Director</option>
                <option value="regional_director">Regional Director</option>
                <option value="director">Director</option>
                <option value="technician">Technician</option>
                <option value="all">Show me all roles</option>
            </select>
            
            <button id="startBtn" class="modal-btn" disabled>Start exploring goals</button>
        </div>
    </div>

    <div id="mainContent" class="container hidden">
        <div class="filters">
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Goal Type</label>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="type" data-value="all">All Goals</button>
                        <button class="filter-btn" data-filter="type" data-value="simple">Simple Goals</button>
                        <button class="filter-btn" data-filter="type" data-value="detailed">Detailed Goals</button>
                    </div>
                </div>

                <div class="filter-group">
                    <label class="filter-label" for="roleSelect">Job Role</label>
                    <select id="roleSelect" class="role-dropdown">
                        <option value="all">All Roles</option>
                        <option value="graduate_engineer">Graduate Engineer</option>
                        <option value="engineer">Engineer</option>
                        <option value="senior_engineer">Senior Engineer</option>
                        <option value="principal_engineer">Principal Engineer</option>
                        <option value="associate_director">Associate Director</option>
                        <option value="regional_director">Regional Director</option>
                        <option value="director">Director</option>
                        <option value="technician">Technician</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="goal-viewer">
            <div class="goal-navigation">
                <button id="prevBtn" class="nav-btn">
                    ← Previous
                </button>
                <div class="goal-counter">
                    <span id="currentGoal">1</span> of <span id="totalGoals">0</span>
                </div>
                <button id="nextBtn" class="nav-btn">
                    Next →
                </button>
            </div>

            <div id="goalContent" class="goal-content">
                </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeModal = document.getElementById('welcomeModal');
            const modalRoleSelect = document.getElementById('modalRoleSelect');
            const startBtn = document.getElementById('startBtn');
            const mainContent = document.getElementById('mainContent');
            const roleSelect = document.getElementById('roleSelect');
            const typeFilterBtns = document.querySelectorAll('.filter-btn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const currentGoalSpan = document.getElementById('currentGoal');
            const totalGoalsSpan = document.getElementById('totalGoals');
            const goalContentDiv = document.getElementById('goalContent');

            let allGoals = [];
            let filteredGoals = [];
            let currentGoalIndex = 0;

            // Fetch and load the goals data from the correct path
            fetch('data/goals-data.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    allGoals = data;
                    showWelcomeModal();
                })
                .catch(error => {
                    console.error('Error loading goals data:', error);
                    goalContentDiv.innerHTML = '<div class="no-goals"><h3>Error loading goals.</h3><p>Please check the file path and try again.</p></div>';
                    welcomeModal.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                });

            // Show the welcome modal
            function showWelcomeModal() {
                welcomeModal.classList.remove('hidden');
            }

            // Enable start button on modal role selection
            modalRoleSelect.addEventListener('change', () => {
                startBtn.disabled = modalRoleSelect.value === '';
            });

            // Start exploring button click handler
            startBtn.addEventListener('click', () => {
                const selectedRole = modalRoleSelect.value;
                if (selectedRole !== '') {
                    roleSelect.value = selectedRole; // Set the main filter dropdown
                    welcomeModal.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    filterAndDisplayGoals();
                }
            });

            // Filter and display goals based on current filters
            function filterAndDisplayGoals() {
                const selectedRole = roleSelect.value;
                const selectedType = document.querySelector('.filter-btn.active').dataset.value;

                filteredGoals = allGoals.filter(goal => {
                    // Special case for 'simple' goals to show all
                    if (selectedType === 'simple') {
                        return goal.type === 'simple';
                    }
                    
                    const roleMatch = (selectedRole === 'all' || goal.role === selectedRole);
                    const typeMatch = (selectedType === 'all' || goal.type === selectedType);
                    return roleMatch && typeMatch;
                });

                currentGoalIndex = 0;
                displayGoal();
            }

            // Display a specific goal
            function displayGoal() {
                if (filteredGoals.length === 0) {
                    goalContentDiv.innerHTML = '<div class="no-goals"><h3>No goals found.</h3><p>Try adjusting your filters.</p></div>';
                    prevBtn.disabled = true;
                    nextBtn.disabled = true;
                    currentGoalSpan.textContent = 0;
                    totalGoalsSpan.textContent = 0;
                    return;
                }

                const goal = filteredGoals[currentGoalIndex];
                const roleLabel = goal.role.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                const categoryLabel = goal.category.toUpperCase();
                const typeLabel = goal.type.toUpperCase();
                const bulletsHtml = goal.bullets.map(bullet => `<li>${bullet}</li>`).join('');

                goalContentDiv.innerHTML = `
                    <div class="goal-meta">
                        <span class="meta-tag job-level">${roleLabel}</span>
                        <span class="meta-tag category">${categoryLabel}</span>
                        <span class="meta-tag type">${typeLabel}</span>
                    </div>
                    <h3 class="goal-title">${goal.title}</h3>
                    <ul class="goal-bullets">${bulletsHtml}</ul>
                    <button class="copy-btn">COPY TO CLIPBOARD</button>
                `;

                // Update goal counter
                currentGoalSpan.textContent = currentGoalIndex + 1;
                totalGoalsSpan.textContent = filteredGoals.length;

                // Update navigation button states
                prevBtn.disabled = currentGoalIndex === 0;
                nextBtn.disabled = currentGoalIndex === filteredGoals.length - 1;

                // Add copy button event listener with the workaround
                goalContentDiv.querySelector('.copy-btn').addEventListener('click', () => {
                    const goalText = `Goal: ${goal.title}\nCategory: ${goal.category}\nRole: ${goal.role}\n\nActions:\n${goal.bullets.map(b => `- ${b}`).join('\n')}`;

                    // Create a temporary, hidden textarea element
                    const tempInput = document.createElement('textarea');
                    tempInput.style.position = 'absolute';
                    tempInput.style.left = '-9999px';
                    tempInput.value = goalText;
                    document.body.appendChild(tempInput);
                    
                    // Select the text and copy it
                    tempInput.select();
                    tempInput.setSelectionRange(0, 99999); // For mobile devices
                    
                    try {
                        // Execute the copy command
                        const successful = document.execCommand('copy');
                        if (successful) {
                            alert('Goal copied to clipboard!');
                        } else {
                            alert('Failed to copy. Please manually select and copy the text.');
                        }
                    } catch (err) {
                        console.error('Could not copy text: ', err);
                        alert('Failed to copy. Please manually select and copy the text.');
                    } finally {
                        // Clean up by removing the temporary element
                        document.body.removeChild(tempInput);
                    }
                });
            }

            // Event listeners for filters and navigation
            roleSelect.addEventListener('change', filterAndDisplayGoals);

            typeFilterBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    typeFilterBtns.forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');

                    const selectedType = e.target.dataset.value;
                    if (selectedType === 'simple') {
                        roleSelect.value = 'all';
                        roleSelect.disabled = true; // Disable the dropdown
                    } else {
                        roleSelect.disabled = false; // Enable the dropdown
                    }
                    
                    filterAndDisplayGoals();
                });
            });

            prevBtn.addEventListener('click', () => {
                if (currentGoalIndex > 0) {
                    currentGoalIndex--;
                    displayGoal();
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentGoalIndex < filteredGoals.length - 1) {
                    currentGoalIndex++;
                    displayGoal();
                }
            });
        });
    </script>
</body>
</html>
